<!DOCTYPE html>
<html ng-app="Test">
<head>
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
    <link rel="stylesheet" href="//netdna.bootstrapcdn.com/bootstrap/3.0.0/css/bootstrap.min.css">
    <link rel="stylesheet" type="text/css"href="theme.css">
    
    <script type="text/javascript" src="http://maps.googleapis.com/maps/api/js?libraries=places&sensor=false"></script>
    <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/angularjs/1.0.8/angular.js"></script>
 
  
</head>

<body>

<br>
<h1>Welcome to Fair Fare!</h1>
<br>
<br>

   	
<div id="addressform" ng-controller="TestCtrl">
<h1>Compare the Best Fare</h1>
<form id="form1" method="POST" role="form">
     <input type="text" id="name" placeholder="NAME"  />
     <input type="text" id="autocomplete1" placeholder="PICKUP LOCATION"/>
     <input type="text" id="autocomplete" placeholder="DROPP OFF LOCATION"/>
     <input id="submit" type="button" name="Save" value="Save" onclick="codeAddress()"/>
    <input id="submit"type="button" name="Get Fare Estimates" value="Get Fare Estimates" onclick="fareestimate()"/>

</form>
</div>
<br>
<br>

<div id="map"></div>

<script>
 function initialize() {
    autocomplete = new google.maps.places.Autocomplete(
            /** @type {!HTMLInputElement} */(document.getElementById('autocomplete1')),
            {types: ['geocode']});
			
    geocoder = new google.maps.Geocoder();
    var latlng = new google.maps.LatLng(-34.397, 150.644);
    var mapOptions = {
      zoom: 8,
      center: latlng
    }
    map = new google.maps.Map(document.getElementById('map'), mapOptions);
	
  }
function codeAddress() {
    var name = document.getElementById('name').value;
	var address = document.getElementById('autocomplete1').value;

	geocoder.geocode( { 'address': address}, function(results, status) {
      if (status == 'OK') {
	  var obj = new Object();
   obj.name = name;
   obj.address  = results[0].address_components[0].long_name +" "+ results[0].address_components[1].long_name;
   obj.city = results[0].address_components[3].short_name;;
   obj.state = results[0].address_components[5].short_name;
   obj.zip = results[0].address_components[7].long_name;
   var jsonString= JSON.stringify(obj);
xhr = new XMLHttpRequest();
var url = "http://127.0.0.1:7000/locations";
xhr.open('POST', url);
xhr.setRequestHeader("Content-type", "application/json; charset=utf-8");
xhr.send(jsonString); 
 map.setCenter(results[0].geometry.location);
        var marker = new google.maps.Marker({
            map: map,
            position: results[0].geometry.location
	
        });
       
        
      } else {
        alert('Geocode was not successful for the following reason: ' + status);
      }
    });
  }
function fareestimate()
    {
        var json = {
            "id": 200000,
            "start": "/locations/12345",
            "best_route_by_costs" : [ 
                "/locations/1002",
                "/locations/1000",
                "/locations/1001",
            ],
            "providers" : [
                {
                    "name" : "Uber",
                    "total_costs_by_cheapest_car_type" : 125,
                    "currency_code": "USD",
                    "total_duration" : 640,
                    "duration_unit": "minute",
                    "total_distance" : 25.05,
                    "distance_unit": "mile"
                },
                {
                    "name" : "Lyft",
                    "total_costs_by_cheapest_car_type" : 110,
                    "currency_code": "USD",
                    "total_duration" : 620,
                    "duration_unit": "minute",
                    "total_distance" : 25.05,
                    "distance_unit": "mile"
                }
            ],
            "end": "/locations/12345",
        };
       
        //var getres = JSON.parse(json);
        document.write(JSON.stringify("Hello your price estimate for "+json.providers[0].name + " would be " +json.providers[0].total_costs_by_cheapest_car_type));
        document.write("<br>");
        document.write(JSON.stringify("Hello your price estimate for "+json.providers[1].name + " would be " +json.providers[1].total_costs_by_cheapest_car_type));
    }
  </script>

  <script async defer
    src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAoKeFrswJ6Btx3tQLF6eN-wE3Iej0WF3Q&libraries=places&callback=initialize">
    </script>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
	
</body>
</html>

